<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ë§ì¶¤ ìš´ë™ - ë°”ë¥¸ ê²°</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        :root { --main-green: #556B2F; --bg-beige: #F9F9F7; }
        body { margin: 0; background: var(--bg-beige); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; padding: 40px 20px; box-sizing: border-box; }
        #input_video { display: none; }
        
        .header { text-align: center; margin-bottom: 20px; }
        .status-badge { background: #E8EDE0; color: var(--main-green); padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 13px; display: inline-block; margin-bottom: 10px; }
        .ex-title { font-size: 24px; font-weight: bold; color: #333; margin: 0; }
        
        .visual-box { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; width: 100%; }
        .giraffe-guide { width: 180px; transition: all 0.5s; }
        
        /* ìš´ë™ ê°€ì´ë“œ ì¹´ë“œ */
        .method-card { background: white; width: 100%; padding: 20px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 30px; text-align: center; }
        .method-card strong { color: var(--main-green); display: block; margin-bottom: 8px; font-size: 17px; }
        .method-card p { margin: 0; font-size: 15px; color: #666; line-height: 1.5; }

        .counter { font-size: 70px; font-weight: 900; color: var(--main-green); margin-bottom: 10px; }
    </style>
</head>
<body>
    <video id="input_video"></video>
    
    <div class="header">
        <div id="statusBadge" class="status-badge">ë¶„ì„ ê²°ê³¼ ë°˜ì˜ ì¤‘...</div>
        <h1 id="exTitle" class="ex-title">ë§ì¶¤ ìŠ¤íŠ¸ë ˆì¹­</h1>
    </div>

    <div class="visual-box">
        <img id="giraffeImg" src="giraffe-character.png" class="giraffe-guide" alt="Giraffe" onerror="this.src='https://img.icons8.com/illustrations/parallax/512/giraffe.png'">
        <div id="counter" class="counter">0</div>
        <div id="targetCount" style="color: #AAA; font-weight: bold;">/ 0íšŒ</div>
    </div>

    <div class="method-card">
        <strong id="methodName">ìš´ë™ ë°©ë²•</strong>
        <p id="methodDesc">AI ê°€ì´ë“œë¥¼ ë”°ë¼ì£¼ì„¸ìš”.</p>
    </div>

    <script>
        const videoElement = document.getElementById('input_video');
        const data = JSON.parse(localStorage.getItem('bareunGyeolReportData') || '{"neckStatus":"good"}');
        
        // 1. ë‹¨ê³„ë³„ ìš´ë™ ì¢…ë¥˜ ë° íšŸìˆ˜ ì •ì˜
        const exerciseLibrary = {
            good: {
                badge: "âœ¨ ê²°ì´ ë§‘ì€ ìƒíƒœ",
                title: "ê¸°ë¦° ê³ ê°œ ê¹Œë”± ìš´ë™",
                method: "ìœ ì—°ì„± ìœ ì§€",
                desc: "ê¸°ë¦°ì²˜ëŸ¼ ê³ ê°œë¥¼ ì¢Œìš°ë¡œ ì²œì²œíˆ ê¸°ìš¸ì´ë©° ëª© ì˜† ë¼ì¸ì˜ ê²°ì„ ì •ë¦¬í•´ì£¼ì„¸ìš”.",
                target: 5
            },
            caution: {
                badge: "ğŸŒ¿ ê²°ì´ ì¡°ê¸ˆ íë ¤ì§„ ìƒíƒœ",
                title: "ê¸°ë¦° ëª© ì­‰ì­‰ ìš´ë™",
                method: "ê¸´ì¥ ì™„í™” ìŠ¤íŠ¸ë ˆì¹­",
                desc: "ì–´ê¹¨ë¥¼ ê³ ì •í•œ ì±„ í„±ì„ ì•ìœ¼ë¡œ ì­‰ ë°€ì—ˆë‹¤ê°€, ë‹¤ì‹œ ë“± ë’¤ë¡œ ë°”ì§ ë‹¹ê²¨ì£¼ì„¸ìš”.",
                target: 8
            },
            severe: {
                badge: "ğŸ”‹ ê²° ì—ë„ˆì§€ê°€ í•„ìš”í•œ ìƒíƒœ",
                title: "ê¸°ë¦° í•˜ëŠ˜ ë³´ê¸° ìš´ë™",
                method: "ì§‘ì¤‘ êµì • ë™ì‘",
                desc: "ê°€ìŠ´ì„ í´ê³  ê³ ê°œë¥¼ ì™„ì „íˆ ë’¤ë¡œ ì –í˜€ í•˜ëŠ˜ì„ ë³´ì„¸ìš”. êµ½ì€ ê²½ì¶”ë¥¼ ë°”ë¡œì¡ëŠ” ë° íš¨ê³¼ì ì…ë‹ˆë‹¤.",
                target: 12
            }
        };

        const config = exerciseLibrary[data.neckStatus];
        
        // UI ì ìš©
        document.getElementById('statusBadge').innerText = config.badge;
        document.getElementById('exTitle').innerText = config.title;
        document.getElementById('methodName').innerText = `[${config.method}]`;
        document.getElementById('methodDesc').innerText = config.desc;
        document.getElementById('targetCount').innerText = `/ ${config.target}íšŒ ì™„ë£Œí•˜ê¸°`;

        let count = 0;
        let isMoving = false;

        function onResults(results) {
            if (!results.poseLandmarks) return;
            const nose = results.poseLandmarks[0];

            // ì‹¤ì œ ì›€ì§ì„ ê°ì§€ ë¡œì§ (ìƒíƒœë³„ë¡œ ë‹¤ë¥¸ ë™ì‘ ê¸°ì¤€ ì ìš© ê°€ëŠ¥)
            if (!isMoving && nose.y > 0.55) { 
                isMoving = true;
            } 
            if (isMoving && nose.y < 0.45) {
                isMoving = false;
                count++;
                document.getElementById('counter').innerText = count;

                if (count >= config.target) {
                    location.href = 'report.html';
                }
            }
        }

        const pose = new Pose({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}` });
        pose.setOptions({ modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
        pose.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => { await pose.send({image: videoElement}); },
            width: 640, height: 480
        });
        camera.start();
    </script>
</body>
</html>
