<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°”ë¥¸ê²° - AI Healthcare Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f2f4f6; margin: 0; overflow-x: hidden; }
        .toss-card { background: white; border-radius: 28px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); }
        .hidden { display: none !important; }
        
        /* ë¶„ì„ í™”ë©´: í”„ë¼ì´ë²„ì‹œ ë¸”ëŸ¬ ì ìš© */
        #video-container { position: relative; width: 100%; height: 100%; border-radius: 40px; overflow: hidden; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); filter: blur(30px) brightness(0.6); }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; transform: scaleX(-1); }
        
        /* íŒŒë€ìƒ‰ ìŠ¤ìº” ë ˆì´ì € */
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: #3182f6; box-shadow: 0 0 20px #3182f6; z-index: 20; animation: scan 3s infinite linear; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        /* ì¹´ìš´íŠ¸ ìˆ«ì í™•ëŒ€/ì¶•ì†Œ ì• ë‹ˆë©”ì´ì…˜ */
        .count-pop { animation: countPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes countPop { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.4); } 100% { transform: scale(1); opacity: 1; } }

        /* ìºë¦­í„° ìš´ë™ ì• ë‹ˆë©”ì´ì…˜ (ê³ ê°œ ìˆ™ì´ê¸°) */
        .ani-stretch { animation: neckStretch 3s infinite ease-in-out; transform-origin: bottom center; }
        @keyframes neckStretch { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(45deg) translateY(5px); } }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen">

    <div id="step1" class="w-full max-w-md flex flex-col items-center p-8 text-center">
        <span class="bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-xs font-bold mb-6 mt-10 uppercase tracking-widest">AI Healthcare Solution</span>
        <h1 class="text-5xl font-black text-[#191f28] mb-6">ë°”ë¥¸ê²°</h1>
        <p class="text-[#4e5968] text-lg mb-12 leading-relaxed font-medium">ë‹¹ì‹ ì˜ ëª© ê±´ê°•, <span class="text-[#3182f6]">AI í˜ì´ìŠ¤ ë¶„ì„</span>ìœ¼ë¡œ<br>ì•ˆì „í•˜ê³  ì •í™•í•˜ê²Œ ì§„ë‹¨í•˜ì„¸ìš”.</p>
        <div class="w-full space-y-4 mb-20">
            <div class="toss-card p-6 flex items-center space-x-5 text-left">
                <div class="text-3xl">ğŸ›¡ï¸</div>
                <div><div class="font-bold text-[#191f28]">í”„ë¼ì´ë²„ì‹œ ë³´í˜¸</div><div class="text-sm text-gray-400">ì–¼êµ´ ë…¸ì¶œ ê±±ì • ì—†ëŠ” ê°•ë ¥ ë¸”ëŸ¬ ì²˜ë¦¬</div></div>
            </div>
            <div class="toss-card p-6 flex items-center space-x-5 text-left">
                <div class="text-3xl">ğŸ“</div>
                <div><div class="font-bold text-[#191f28]">ì •ë°€ ë¶„ì„ ê·¸ë¬¼ë§</div><div class="text-sm text-gray-400">ì‹¤ì‹œê°„ ì–¼êµ´ ì¢Œí‘œë¥¼ í†µí•œ í•˜ì¤‘ ì¸¡ì •</div></div>
            </div>
        </div>
        <button onclick="showStep(2)" class="w-full bg-[#3182f6] text-white py-6 rounded-3xl font-bold text-xl shadow-xl active:scale-95 transition-all">ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="step2" class="hidden w-full max-w-md flex flex-col items-center justify-center p-8 text-center mt-20">
        <h2 class="text-3xl font-bold mb-6 text-[#191f28]">í‰ì†Œ ëª¨ìŠµ ê·¸ëŒ€ë¡œ<br>ì •ë©´ì„ ë´ì£¼ì„¸ìš”</h2>
        <div class="w-32 h-40 relative mb-10">
            <div class="absolute bottom-0 w-20 h-20 bg-blue-500 rounded-2xl left-6 opacity-10"></div>
            <div class="absolute top-4 w-16 h-16 bg-[#ffdbac] rounded-full left-8 shadow-sm"></div>
        </div>
        <p class="text-gray-500 mb-10">AIê°€ ë‹¹ì‹ ì˜ ëª© ê°ë„ë¥¼ ì§„ë‹¨í•˜ëŠ” ë™ì•ˆ<br>ì¹´ë©”ë¼ê°€ ì–¼êµ´ì„ ì•ˆì „í•˜ê²Œ ê°€ë ¤ì¤ë‹ˆë‹¤.</p>
        <button onclick="initAI()" class="w-full bg-[#3182f6] text-white py-6 rounded-3xl font-bold text-lg">ì¹´ë©”ë¼ ì¼œê¸°</button>
    </div>

    <div id="step3" class="hidden w-full max-w-md p-6 flex flex-col items-center">
        <div id="video-container" class="aspect-[3/4] shadow-2xl mb-8 border-4 border-white">
            <div class="scan-line"></div>
            <video id="video" playsinline></video>
            <canvas id="canvas"></canvas>
            <div id="angle-tag" class="absolute bottom-10 left-1/2 -translate-x-1/2 bg-white/95 text-blue-600 px-8 py-3 rounded-full font-black text-2xl z-20 shadow-xl border border-blue-50">ë¶„ì„ ì¤‘...</div>
        </div>
        <div id="analysis-finish" class="hidden w-full toss-card p-8 text-center">
            <p class="text-blue-600 font-bold mb-4">ì •ë°€ ì§„ë‹¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            <button onclick="showStep(4)" class="w-full bg-[#3182f6] text-white py-5 rounded-2xl font-bold">ë§ì¶¤ ìš´ë™ë²• í™•ì¸í•˜ê¸°</button>
        </div>
    </div>

    <div id="step4" class="hidden w-full max-w-md flex flex-col items-center p-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-[#191f28]">ê³ ê°œë¥¼ ê¹Šê²Œ ìˆ™ì˜€ë‹¤ê°€<br>ì²œì²œíˆ ëŒì•„ì˜¤ì„¸ìš”</h2>
        <div class="w-32 h-40 relative mb-8">
            <div class="absolute bottom-0 w-20 h-20 bg-blue-500 rounded-2xl left-6"></div>
            <div class="absolute top-4 w-16 h-16 bg-[#ffdbac] rounded-full left-8 ani-stretch shadow-md"></div>
        </div>
        <div class="toss-card w-full p-10 mb-8">
            <div id="count-number" class="text-8xl font-black text-blue-600">10</div>
            <div id="status-msg" class="text-gray-400 mt-4 font-bold tracking-widest">REMAINING</div>
        </div>
    </div>

    <div id="step5" class="hidden w-full max-w-md p-6 flex flex-col items-center overflow-y-auto pb-10">
        <div class="w-full toss-card p-10 bg-white shadow-xl">
            <h2 class="text-2xl font-bold text-center mb-10 text-[#191f28]">AI ì •ë°€ ì§„ë‹¨ ë¦¬í¬íŠ¸</h2>
            <div class="text-center mb-10">
                <div id="final-angle" class="text-7xl font-black text-red-500 mb-2">0Â°</div>
                <div class="text-gray-400 font-bold">ì˜¤ëŠ˜ì˜ ìš´ë™ ì ìˆ˜: 98ì </div>
            </div>
            
            <div id="comment-box" class="rounded-3xl p-8 mb-10 text-center border">
                <p id="final-comment" class="text-[#191f28] leading-relaxed font-medium text-lg"></p>
            </div>

            <div class="space-y-4 mb-10">
                <div class="p-5 bg-blue-50 rounded-2xl text-left border border-blue-100">
                    <div class="text-blue-600 font-bold text-sm mb-1">ğŸ“‹ ì¶”ì²œ ì²˜ë°©</div>
                    <div id="prescribe-text" class="text-blue-900 font-medium text-base"></div>
                </div>
                <div class="p-5 bg-green-50 rounded-2xl text-left border border-green-100">
                    <div class="text-green-600 font-bold text-sm mb-1">âœ¨ ê¸°ëŒ€ íš¨ê³¼</div>
                    <div class="text-green-900 font-medium text-sm leading-relaxed">ë‹¨ì¶•ëœ í›„ë‘í•˜ê·¼ì´ ì´ì™„ë˜ì–´ ëª©ì˜ ì •ë ¬ì´ ì •ìƒí™”ë˜ê³ , ë§Œì„±ì ì¸ ì–´ê¹¨ ê²°ë¦¼ê³¼ ë‘í†µì´ ì˜ˆë°©ë©ë‹ˆë‹¤.</div>
                </div>
            </div>
            <button onclick="location.reload()" class="w-full bg-[#3182f6] text-white py-5 rounded-3xl font-bold text-xl shadow-lg active:scale-95 transition-transform">ë‹¤ì‹œ ì¸¡ì •í•˜ê¸°</button>
        </div>
    </div>

    <script>
        let faceMesh;
        let count = 10;
        let finalAngle = 0;
        let isStretched = false;

        function showStep(n) {
            document.querySelectorAll('body > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('step' + n).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        async function initAI() {
            showStep(3);
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            faceMesh = new FaceMesh({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}` });
            faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.5 });
            faceMesh.onResults((results) => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                    for (const landmarks of results.multiFaceLandmarks) {
                        drawConnectors(ctx, landmarks, FACEMESH_TESSELATION, {color: '#3182f680', lineWidth: 1});
                        const nose = landmarks[1]; const ear = landmarks[234];
                        finalAngle = Math.round(Math.abs(nose.x - ear.x) * 450);
                        document.getElementById('angle-tag').innerText = `í˜„ì¬ ê°ë„: ${finalAngle}Â°`;

                        if (!document.getElementById('step4').classList.contains('hidden')) {
                            if (nose.y > 0.65 && !isStretched) isStretched = true;
                            if (nose.y < 0.45 && isStretched) {
                                isStretched = false;
                                updateCount();
                            }
                        }
                    }
                }
            });

            const camera = new Camera(video, {
                onFrame: async () => {
                    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                    await faceMesh.send({image: video});
                }, width: 640, height: 480
            });
            camera.start();
            setTimeout(() => { document.getElementById('analysis-finish').classList.remove('hidden'); }, 4000);
        }

        function updateCount() {
            count--;
            const countEl = document.getElementById('count-number');
            countEl.innerText = count;
            countEl.classList.remove('count-pop');
            void countEl.offsetWidth; 
            countEl.classList.add('count-pop');

            if (count <= 0) {
                document.getElementById('status-msg').innerText = "ì¶•í•˜í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ì˜ ìš´ë™ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰";
                document.getElementById('status-msg').className = "text-blue-600 mt-4 font-black text-xl animate-bounce";
                setTimeout(() => finalizeReport(), 2000);
            }
        }

        function finalizeReport() {
            showStep(5);
            document.getElementById('final-angle').innerText = `${finalAngle}Â°`;
            const comment = document.getElementById('final-comment');
            const prescribe = document.getElementById('prescribe-text');
            const box = document.getElementById('comment-box');
            
            

            if (finalAngle >= 45) {
                comment.innerHTML = `í˜„ì¬ ë‹¹ì‹ ì˜ ëª©ì€ <span class="text-red-600 font-bold underline">10kg ìŒ€ í•œ í¬ëŒ€</span>ë¥¼ ì§Šì–´ì§€ê³  ìˆëŠ” ê²ƒê³¼ ê°™ì•„ìš”! ğŸ˜±`;
                prescribe.innerText = "ë§¤ì¼ 20íšŒì”© 5ì„¸íŠ¸ ì§‘ì¤‘ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                box.className = "rounded-3xl p-8 mb-10 text-center border-2 border-red-100 bg-red-50";
            } else if (finalAngle >= 30) {
                comment.innerHTML = `ì§€ê¸ˆ ë‹¹ì‹ ì˜ ëª©ì€ <span class="text-orange-500 font-bold underline">5kg ìˆ˜ë°• í•œ í†µ</span>ì˜ ë¬´ê²Œë¥¼ ê²¬ë””ê³  ìˆì–´ìš”! ğŸ‰`;
                prescribe.innerText = "ë§¤ì¼ 15íšŒì”© 3ì„¸íŠ¸ ê¾¸ì¤€íˆ ìš´ë™í•˜ì„¸ìš”.";
                box.className = "rounded-3xl p-8 mb-10 text-center border-2 border-orange-100 bg-orange-50";
            } else if (finalAngle >= 15) {
                comment.innerHTML = `í˜„ì¬ ëª©ì˜ ë¬´ê²ŒëŠ” <span class="text-yellow-600 font-bold">ê°€ë²¼ìš´ í•¸ë“œë°±</span> ì •ë„ì…ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ê´€ë¦¬í•´ë³¼ê¹Œìš”? ğŸ‘œ`;
                prescribe.innerText = "í•˜ë£¨ 10íšŒì”© 2ì„¸íŠ¸ ê¶Œì¥í•©ë‹ˆë‹¤.";
                box.className = "rounded-3xl p-8 mb-10 text-center border-2 border-yellow-100 bg-yellow-50";
            } else {
                comment.innerHTML = `ì •ë§ í›Œë¥­í•´ìš”! ëª©ì˜ ë¬´ê²Œê°€ <span class="text-blue-600 font-bold">ê¹ƒí„¸ì²˜ëŸ¼ ê°€ë³ê²Œ</span> ëŠê»´ì§€ëŠ” ì™„ë²½í•œ ìƒíƒœì…ë‹ˆë‹¤. âœ¨`;
                prescribe.innerText = "í˜„ì¬ ìì„¸ë¥¼ ìœ ì§€í•˜ë©° í•˜ë£¨ 1ì„¸íŠ¸ì”© ìŠ¤íŠ¸ë ˆì¹­í•˜ì„¸ìš”.";
                box.className = "rounded-3xl p-8 mb-10 text-center border-2 border-blue-100 bg-blue-50";
            }
        }
    </script>
</body>
</html>
