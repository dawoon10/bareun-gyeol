<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°”ë¥¸ê²° - AI Healthcare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f2f4f6; margin: 0; }
        .toss-card { background: white; border-radius: 28px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); }
        .hidden { display: none !important; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; }
        video { object-fit: cover; width: 100%; height: 100%; -scale-x-1; }
        
        /* ìºë¦­í„° ê³ ê°œ ìˆ™ì´ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .ani-stretch { animation: neckStretch 3s infinite ease-in-out; transform-origin: bottom center; }
        @keyframes neckStretch { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(45deg); } }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen">

    <div id="step1" class="w-full max-w-md flex flex-col items-center p-8 text-center bg-[#f9fafb]">
        <span class="bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-xs font-bold mb-6 mt-10 uppercase tracking-widest">AI Healthcare Solution</span>
        <h1 class="text-5xl font-black text-[#191f28] mb-6">ë°”ë¥¸ê²°</h1>
        <p class="text-[#4e5968] text-lg mb-12">ë‹¹ì‹ ì˜ ëª© ê±´ê°•, <span class="font-bold text-[#3182f6]">ì–¼êµ´ ê·¸ë¬¼ë§ AI</span>ê°€<br>ì‹¤ì‹œê°„ìœ¼ë¡œ ì •ë°€ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.</p>
        <div class="w-full space-y-4 mb-20">
            <div class="toss-card p-6 flex items-center space-x-5 text-left">
                <div class="w-14 h-14 bg-blue-500 rounded-2xl flex items-center justify-center text-white text-2xl">ğŸ•¸ï¸</div>
                <div><div class="font-bold text-lg">í˜ì´ìŠ¤ ê·¸ë¬¼ë§ ë¶„ì„</div><div class="text-sm text-gray-400 font-medium">468ê°œì˜ í¬ì¸íŠ¸ë¡œ ì •ë°€ ì§„ë‹¨</div></div>
            </div>
            <div class="toss-card p-6 flex items-center space-x-5 text-left">
                <div class="w-14 h-14 bg-green-500 rounded-2xl flex items-center justify-center text-white text-2xl">ğŸ“‹</div>
                <div><div class="font-bold text-lg">ì„±ì¥ ë¦¬í¬íŠ¸</div><div class="text-sm text-gray-400 font-medium">10kg ìŒ€ í¬ëŒ€ ë¹„ìœ  ë¶„ì„</div></div>
            </div>
        </div>
        <button onclick="showStep(2)" class="w-full bg-[#3182f6] text-white py-6 rounded-3xl font-bold text-xl shadow-2xl active:scale-95 transition-all">ì§€ê¸ˆ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="step2" class="hidden w-full max-w-md flex flex-col items-center justify-center p-8 text-center mt-20">
        <h2 class="text-3xl font-bold mb-6 text-[#191f28]">ê·¸ë¬¼ë§ ìƒì„±ì„ ìœ„í•´<br>ì •ë©´ì„ ë´ì£¼ì„¸ìš”</h2>
        <div class="w-32 h-40 relative mb-10"><div class="absolute bottom-0 w-20 h-20 bg-blue-500 rounded-2xl left-6"></div><div class="absolute top-4 w-16 h-16 bg-[#ffdbac] rounded-full left-8"></div></div>
        <button onclick="initAI()" class="w-full bg-[#3182f6] text-white py-6 rounded-3xl font-bold text-lg">AI ì¹´ë©”ë¼ ì¼œê¸°</button>
    </div>

    <div id="step3" class="hidden w-full max-w-md p-6 flex flex-col items-center">
        <div class="w-full aspect-[3/4] bg-black rounded-[40px] overflow-hidden relative shadow-2xl mb-8">
            <video id="video" playsinline></video>
            <canvas id="canvas"></canvas>
            <div id="angle-indicator" class="absolute bottom-10 left-1/2 -translate-x-1/2 bg-blue-600/90 text-white px-8 py-3 rounded-full font-black text-2xl z-20">ì¸¡ì • ì¤‘...</div>
        </div>
        <div id="analysis-finish" class="hidden w-full toss-card p-8 text-center animate-bounce">
            <button onclick="showStep(4)" class="w-full bg-[#3182f6] text-white py-5 rounded-2xl font-bold">10íšŒ êµì • ìš´ë™ ì‹œì‘</button>
        </div>
    </div>

    <div id="step4" class="hidden w-full max-w-md flex flex-col items-center p-8 text-center">
        <h2 class="text-2xl font-bold mb-8">ê³ ê°œë¥¼ ê¹Šê²Œ ìˆ™ì—¬ì£¼ì„¸ìš”</h2>
        <div class="w-32 h-40 relative mb-8"><div class="absolute bottom-0 w-20 h-20 bg-blue-500 rounded-2xl left-6"></div><div class="absolute top-4 w-16 h-16 bg-[#ffdbac] rounded-full left-8 ani-stretch"></div></div>
        <div class="toss-card w-full p-10">
            <div id="exercise-count" class="text-8xl font-black text-blue-600">10</div>
            <div class="text-gray-400 mt-4 font-bold">REPS LEFT</div>
        </div>
    </div>

    <div id="step5" class="hidden w-full max-w-md p-6 flex flex-col items-center">
        <div class="w-full toss-card p-10 bg-white">
            <h2 class="text-2xl font-bold text-center mb-10">AI ì •ë°€ ë¦¬í¬íŠ¸</h2>
            <div class="text-center mb-12">
                <div id="final-angle" class="text-7xl font-black text-red-500 mb-2">0Â°</div>
                <div class="text-red-600 font-bold bg-red-50 py-2 px-6 rounded-full inline-block">ê±°ë¶ëª© ìœ„í—˜êµ°</div>
            </div>
            <div class="bg-gray-50 rounded-[30px] p-8 mb-10 border border-gray-100">
                <p class="text-[#191f28] leading-relaxed text-lg font-medium text-center">
                    í˜„ì¬ ë‹¹ì‹ ì˜ ëª©ì€ <span class="text-red-600 font-bold underline decoration-4">10kg ìŒ€ í•œ í¬ëŒ€</span>ë¥¼<br>ì§Šì–´ì§€ê³  ìˆëŠ” ê²ƒê³¼ ê°™ì•„ìš”! ğŸ˜±
                </p>
            </div>
            <button onclick="location.reload()" class="w-full bg-[#3182f6] text-white py-5 rounded-3xl font-bold text-xl">ë‚´ì¼ë„ ì¸¡ì •í•˜ê¸°</button>
        </div>
    </div>

    <script>
        let faceMesh;
        let count = 10;
        let finalAngle = 0;
        let isStretched = false;

        function showStep(n) {
            document.querySelectorAll('body > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('step' + n).classList.remove('hidden');
        }

        async function initAI() {
            showStep(3);
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            faceMesh = new FaceMesh({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
            });

            faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.5 });
            faceMesh.onResults((results) => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (results.multiFaceLandmarks) {
                    for (const landmarks of results.multiFaceLandmarks) {
                        // ì–¼êµ´ ê·¸ë¬¼ë§(Mesh) ê·¸ë¦¬ê¸°
                        drawConnectors(ctx, landmarks, FACEMESH_TESSELATION, {color: '#C0C0C070', lineWidth: 1});
                        
                        // ê°ë„ ê³„ì‚° ë¡œì§ (ì½”ì™€ ê·€ì˜ ê±°ë¦¬ë¥¼ ì´ìš©í•œ ê°ë„ ì‚°ì¶œ)
                        const nose = landmarks[1]; 
                        const ear = landmarks[234];
                        const dist = Math.abs(nose.x - ear.x) * 500;
                        finalAngle = Math.round(dist);
                        document.getElementById('angle-indicator').innerText = `ì‹¤ì‹œê°„: ${finalAngle}Â°`;

                        // ìš´ë™ ì¹´ìš´íŒ… ë¡œì§ (ê³ ê°œ ìˆ™ì„ ê°ì§€)
                        if (document.getElementById('step4').offsetParent !== null) {
                            if (nose.y > 0.6 && !isStretched) { isStretched = true; }
                            if (nose.y < 0.4 && isStretched) {
                                isStretched = false;
                                count--;
                                document.getElementById('exercise-count').innerText = count;
                                if (count <= 0) showStep(5);
                                document.getElementById('final-angle').innerText = `${finalAngle}Â°`;
                            }
                        }
                    }
                }
            });

            const camera = new Camera(video, {
                onFrame: async () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    await faceMesh.send({image: video});
                },
                width: 640, height: 480
            });
            camera.start();

            setTimeout(() => { document.getElementById('analysis-finish').classList.remove('hidden'); }, 5000);
        }
    </script>
</body>
</html>
